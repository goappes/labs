<?xml version="1.0" encoding="UTF-8"?>
<project>
    <!-- <target name="-pre-clean">
        <echo message="Removing the www dir"/>
        <delete dir="assets/www"/>
    </target> -->
    <target name="-pre-build">
        <echo message="Generating dist"/>
        <!-- <copy file="assets/www/cordova.js" tofile="../../dist/cordova.js"/>
        <copy file="assets/www/cordova_plugins.js" tofile="../../dist/cordova_plugins.js"/>
        <copy todir="../../dist/plugins">
          <fileset dir="assets/www/plugins"/>
        </copy> -->
        <delete dir="assets/www/scripts"/>
        <delete dir="assets/www/styles"/>
        <delete dir="assets/www/images"/>
        <delete dir="assets/www/bower_components"/>
        <delete file="assets/www/index.html.tpl"/>
        <exec dir="../../" command="grunt make" failifexecutionfails="true" failonerror="true"/>
        <echo message="Updating the www directory"/>
        <copy todir="assets/www">
          <fileset dir="../../dist"/>
        </copy>
    </target>
    <target name="-pre-compile">
        <!-- Fix library references due to bug in build.xml: See: https://groups.google.com/forum/#!topic/android-developers/0ivH-YqCjzg -->
        <pathconvert property="fixedJarsPath" refid="project.all.jars.path">
          <filtermapper>
            <replacestring from="/bin/" to="/ant-build/"/>
            <replacestring from="\bin\" to="\ant-build\"/>
          </filtermapper>
        </pathconvert>
        <path id="project.all.jars.path">
          <pathelement path="${fixedJarsPath}"/>
        </path>
        <echo message="Set jars path to: ${toString:project.all.jars.path}"/>
    </target>
    <target name="-post-build">
        <property file="secure.properties" />
        <move file="ant-build/AndroidManifest.xml" tofile="ant-build/AndroidManifest.cordova.xml" failonerror="false" overwrite="true" />
        <move file="CordovaLib/ant-build/AndroidManifest.xml" tofile="CordovaLib/ant-build/AndroidManifest.cordova.xml" failonerror="false" overwrite="true" />
    </target>
</project>

